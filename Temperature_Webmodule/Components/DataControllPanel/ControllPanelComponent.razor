@using TemperatureModule.Webpage.Models
@using BlazorDateRangePicker
@using TemperatureModule.Webpage.HelpClasses

@using TemperatureModule.Webpage.Components.DataControllPanel.Dropdown


<StyleSheet Resource="assets/css/myown/ControllPanel.css" Assembly="GetType().Assembly"></StyleSheet>
<link rel="stylesheet" href="/assets/css/styles.min.css">

<div class="graph-controllpanel" style="display:flex; flex-direction:row; flex-wrap:wrap">

    <h1 style="color: #f4f7f5; order:1">Lövekulle camping</h1>

    <DateRangePicker class="order-6 dateRangePicker" placeholder="@StartDate.GetValueOrDefault().DateTime.ToShortDateString()"
                     ShowOnlyOneCalendar="true" SingleDatePicker="false" StartDate="StartDate" EndDate="EndDate" OnRangeSelect="OnDateSelected" Culture="culture" />
    <div style="order:7">
        <DropdownFilterComponent Tip="@dropdownTip" Filters="filterList" SelectUpdated="OnSelected" />
    </div>
</div>
@code {
    private System.Globalization.CultureInfo culture = System.Globalization.CultureInfo.GetCultureInfo("sv-SE");

    [Parameter]
    public EventCallback<FilterEnum> SelectUpdated { get; set; }

    [Parameter]
    public EventCallback<DateRange> DateUpdated { get; set; }

    [Parameter]
    public DateTimeOffset? StartDate { get; set; }

    [Parameter]
    public DateTimeOffset? EndDate { get; set; }

    private List<string> filterList = new List<string> { "Today", "Yesterday", "1 day", "3 days", "1 week", "2 weeks", "1 month", "3 months", "1 year" };

    private string dropdownTip { get; set; }

    public async Task OnSelected(FilterEnum selection)
    {
        await SelectUpdated.InvokeAsync(selection);
        var range = FilterEnumHelper.GetDateRange(selection);
        StartDate = range.Start;
        EndDate = range.End;
        dropdownTip = filterList[(int)selection];
    }

    public async Task OnDateSelected(DateRange range)
    {
        await DateUpdated.InvokeAsync(range);

        dropdownTip = "Custom date";
        StartDate = range.Start;
        EndDate = range.End;
    }

    protected override async Task OnInitializedAsync()
    {
        dropdownTip = filterList[0];
    }
}
